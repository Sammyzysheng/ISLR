<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Solutions | An Introduction to Statistical Learning:</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.2.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../chapter9/index.html" />
    
    
    <link rel="prev" href="../chapter8/lab.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="7.2" data-basepath=".." data-revision="Wed Aug 19 2015 19:44:06 GMT+0100 (BST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="chapter2/index.html">
            
                
                    <a href="../chapter2/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Chapter 2. Statistical Learning
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="chapter2/lab.html">
            
                
                    <a href="../chapter2/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="chapter2/solutions.html">
            
                
                    <a href="../chapter2/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="chapter3/index.html">
            
                
                    <a href="../chapter3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Chapter 3. Linear Regression
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="chapter3/lab.html">
            
                
                    <a href="../chapter3/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="chapter3/solutions.html">
            
                
                    <a href="../chapter3/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="chapter4/index.html">
            
                
                    <a href="../chapter4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Chapter 4. Classification
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="chapter4/lab.html">
            
                
                    <a href="../chapter4/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="chapter4/solutions.html">
            
                
                    <a href="../chapter4/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="chapter5/index.html">
            
                
                    <a href="../chapter5/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Chapter 5. Resampling Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="chapter5/lab.html">
            
                
                    <a href="../chapter5/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="chapter5/solutions.html">
            
                
                    <a href="../chapter5/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="chapter6/index.html">
            
                
                    <a href="../chapter6/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Chapter 6. Linear Model Selection and Regularization
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="chapter6/lab.html">
            
                
                    <a href="../chapter6/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="chapter6/solutions.html">
            
                
                    <a href="../chapter6/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="chapter7/index.html">
            
                
                    <a href="../chapter7/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Chapter 7. Moving Beyond Linearity
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="chapter7/lab.html">
            
                
                    <a href="../chapter7/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="chapter7/solutions.html">
            
                
                    <a href="../chapter7/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="chapter8/index.html">
            
                
                    <a href="../chapter8/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Chapter 8. Tree-Based Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="chapter8/lab.html">
            
                
                    <a href="../chapter8/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="7.2" data-path="chapter8/solutions.html">
            
                
                    <a href="../chapter8/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="chapter9/index.html">
            
                
                    <a href="../chapter9/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Chapter 9. Support Vector Machines
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="chapter9/lab.html">
            
                
                    <a href="../chapter9/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="chapter9/solutions.html">
            
                
                    <a href="../chapter9/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="chapter10/index.html">
            
                
                    <a href="../chapter10/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Chapter 10. Unsupervised Learning
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="chapter10/lab.html">
            
                
                    <a href="../chapter10/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="chapter10/solutions.html">
            
                
                    <a href="../chapter10/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="references.html">
            
                
                    <a href="../references.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        References
                    </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >An Introduction to Statistical Learning:</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="8-4-exercises">8.4 Exercises</h2>
<h3 id="exercise-3">Exercise 3</h3>
<pre><code class="lang-r">p1 &lt;- seq(<span class="hljs-number">0</span> + <span class="hljs-number">1e-06</span>, <span class="hljs-number">1</span> - <span class="hljs-number">1e-06</span>, length.out = <span class="hljs-number">100</span>)
p2 &lt;- <span class="hljs-number">1</span> - p1

<span class="hljs-comment"># The missclassification error-rate:</span>
E &lt;- <span class="hljs-number">1</span> - apply(rbind(p1, p2), <span class="hljs-number">2</span>, max)

<span class="hljs-comment"># The Gini index:</span>
G &lt;- p1 * (<span class="hljs-number">1</span> - p1) + p2 * (<span class="hljs-number">1</span> - p2)

<span class="hljs-comment"># The cross-entropy:</span>
D &lt;- -(p1 * log(p1) + p2 * log(p2))

plot(p1, E, type = <span class="hljs-string">&quot;l&quot;</span>, col = <span class="hljs-string">&quot;black&quot;</span>, xlab = <span class="hljs-string">&quot;p_1&quot;</span>, ylab = <span class="hljs-string">&quot;value of error metric&quot;</span>, ylim = c(min(c(E, G, D)), max(E, G, D)))
lines(p1, G, col = <span class="hljs-string">&quot;blue&quot;</span>)
lines(p1, D, col = <span class="hljs-string">&quot;green&quot;</span>)
legend(<span class="hljs-number">0.2</span>, <span class="hljs-number">0.1</span>, c(<span class="hljs-string">&quot;Classification error&quot;</span>, <span class="hljs-string">&quot;Gini index&quot;</span>, <span class="hljs-string">&quot;Cross entropy&quot;</span>), col = c(<span class="hljs-string">&quot;black&quot;</span>, <span class="hljs-string">&quot;blue&quot;</span>, <span class="hljs-string">&quot;green&quot;</span>), lty = c(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))
grid()
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-1-1.png" alt=""></p>
<h3 id="exercise-7">Exercise 7</h3>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(MASS)
<span class="hljs-keyword">library</span>(randomForest)
</code></pre>
<pre><code>## randomForest 4.6-10
## Type rfNews() to see new features/changes/bug fixes.
</code></pre><pre><code class="lang-r">set.seed(<span class="hljs-number">0</span>)

n &lt;- nrow(Boston)
p &lt;- ncol(Boston) - <span class="hljs-number">1</span>  <span class="hljs-comment"># one column is the response we are trying to model i.e. &apos;medv&apos; </span>

train &lt;- sample(<span class="hljs-number">1</span>:n, n/<span class="hljs-number">2</span>)
test &lt;- (<span class="hljs-number">1</span>:n)[-train]

ntree_to_test &lt;- seq(from = <span class="hljs-number">1</span>, to = <span class="hljs-number">500</span>, by = <span class="hljs-number">10</span>)

<span class="hljs-comment"># For a number of mtry values and a number of trees look at the test error rate:</span>

<span class="hljs-comment"># For mtry == p:</span>
mse.bag &lt;- rep(<span class="hljs-literal">NA</span>, length(ntree_to_test))
<span class="hljs-keyword">for</span> (nti <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(ntree_to_test)) {
    nt &lt;- ntree_to_test[nti]

    <span class="hljs-comment"># Grow a tree with &apos;nt&apos; trees:</span>
    boston.bag &lt;- randomForest(medv ~ ., data = Boston, mtry = p, ntree = nt, importance = <span class="hljs-literal">TRUE</span>, subset = train)

    <span class="hljs-comment"># Make predictions with this tree on the test dataset:</span>
    y_hat &lt;- predict(boston.bag, newdata = Boston[test, ])

    mse.bag[nti] &lt;- mean((Boston[test, ]$medv - y_hat)^<span class="hljs-number">2</span>)
}

<span class="hljs-comment"># For mtry=p/2:</span>
mse.p_over_two &lt;- rep(<span class="hljs-literal">NA</span>, length(ntree_to_test))
<span class="hljs-keyword">for</span> (nti <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(ntree_to_test)) {
    nt &lt;- ntree_to_test[nti]

    <span class="hljs-comment"># Grow a tree with &apos;nt&apos; trees:</span>
    boston.bag &lt;- randomForest(medv ~ ., data = Boston, mtry = p/<span class="hljs-number">2</span>, ntree = nt, importance = <span class="hljs-literal">TRUE</span>, subset = train)

    <span class="hljs-comment"># Make predictions with this tree on the test dataset:</span>
    y_hat &lt;- predict(boston.bag, newdata = Boston[test, ])

    mse.p_over_two[nti] &lt;- mean((Boston[test, ]$medv - y_hat)^<span class="hljs-number">2</span>)
}


<span class="hljs-comment"># Run random forest with mtry=sqrt(p) and test on test set</span>
mse.sqrt_p &lt;- rep(<span class="hljs-literal">NA</span>, length(ntree_to_test))
<span class="hljs-keyword">for</span> (nti <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(ntree_to_test)) {
    nt &lt;- ntree_to_test[nti]

    <span class="hljs-comment"># Grow a tree with &apos;nt&apos; trees:</span>
    boston.bag &lt;- randomForest(medv ~ ., data = Boston, mtry = p/<span class="hljs-number">2</span>, ntree = nt, importance = <span class="hljs-literal">TRUE</span>, subset = train)

    <span class="hljs-comment"># Make predictions with this tree on the test dataset:</span>
    y_hat &lt;- predict(boston.bag, newdata = Boston[test, ])

    mse.sqrt_p[nti] &lt;- mean((Boston[test, ]$medv - y_hat)^<span class="hljs-number">2</span>)
}

plot(ntree_to_test, mse.bag, xlab = <span class="hljs-string">&quot;Number of Trees&quot;</span>, ylab = <span class="hljs-string">&quot;Test MSE&quot;</span>, col = <span class="hljs-string">&quot;red&quot;</span>, type = <span class="hljs-string">&quot;l&quot;</span>)
lines(ntree_to_test, mse.p_over_two, xlab = <span class="hljs-string">&quot;Number of Trees&quot;</span>, ylab = <span class="hljs-string">&quot;Test MSE&quot;</span>, col = <span class="hljs-string">&quot;blue&quot;</span>, type = <span class="hljs-string">&quot;l&quot;</span>)
lines(ntree_to_test, mse.sqrt_p, xlab = <span class="hljs-string">&quot;Number of Trees&quot;</span>, ylab = <span class="hljs-string">&quot;Test MSE&quot;</span>, col = <span class="hljs-string">&quot;green&quot;</span>, type = <span class="hljs-string">&quot;l&quot;</span>)
grid()
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-2-1.png" alt=""></p>
<h3 id="exercise-8">Exercise 8</h3>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(tree)
<span class="hljs-keyword">library</span>(ISLR)
<span class="hljs-keyword">attach</span>(Carseats)

set.seed(<span class="hljs-number">0</span>)

n &lt;- nrow(Carseats)
p &lt;- ncol(Carseats) - <span class="hljs-number">1</span>  <span class="hljs-comment"># remove the column we seek to predict i.e. Sales</span>

<span class="hljs-comment"># Part (a):</span>
train &lt;- sample(<span class="hljs-number">1</span>:n, n/<span class="hljs-number">2</span>)
test &lt;- (<span class="hljs-number">1</span>:n)[-train]

<span class="hljs-comment"># Part (b):</span>
rtree.carseats &lt;- tree(Sales ~ ., data = Carseats[train, ])
summary(rtree.carseats)
</code></pre>
<pre><code>## 
## Regression tree:
## tree(formula = Sales ~ ., data = Carseats[train, ])
## Variables actually used in tree construction:
## [1] &quot;ShelveLoc&quot;   &quot;Price&quot;       &quot;Age&quot;         &quot;Population&quot;  &quot;Income&quot;     
## [6] &quot;Advertising&quot; &quot;CompPrice&quot;  
## Number of terminal nodes:  18 
## Residual mean deviance:  1.828 = 332.6 / 182 
## Distribution of residuals:
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -3.47100 -0.85760  0.01643  0.00000  0.96960  3.09800
</code></pre><pre><code class="lang-r">plot(rtree.carseats)
text(rtree.carseats, pretty = <span class="hljs-number">0</span>)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-3-1.png" alt=""></p>
<pre><code class="lang-r">print(rtree.carseats)
</code></pre>
<pre><code>## node), split, n, deviance, yval
##       * denotes terminal node
## 
##   1) root 200 1282.000  7.275  
##     2) ShelveLoc: Bad,Medium 168  884.600  6.807  
##       4) Price &lt; 94.5 32   94.160  8.919  
##         8) Age &lt; 35.5 5   12.750 10.980 *
##         9) Age &gt; 35.5 27   56.200  8.537  
##          18) Population &lt; 56.5 5   10.500 10.170 *
##          19) Population &gt; 56.5 22   29.300  8.166 *
##       5) Price &gt; 94.5 136  614.000  6.309  
##        10) ShelveLoc: Bad 39  138.300  4.740  
##          20) Population &lt; 180.5 14   32.200  3.574  
##            40) Price &lt; 120.5 7    4.681  4.617 *
##            41) Price &gt; 120.5 7   12.300  2.531 *
##          21) Population &gt; 180.5 25   76.380  5.392  
##            42) Income &lt; 95.5 19   26.870  4.862 *
##            43) Income &gt; 95.5 6   27.200  7.073 *
##        11) ShelveLoc: Medium 97  341.000  6.941  
##          22) Advertising &lt; 6.5 51  129.300  6.239  
##            44) Age &lt; 41.5 14   16.590  7.238 *
##            45) Age &gt; 41.5 37   93.490  5.861  
##              90) Price &lt; 127 23   34.700  6.444 *
##              91) Price &gt; 127 14   38.140  4.904  
##               182) CompPrice &lt; 132.5 6    5.325  3.707 *
##               183) CompPrice &gt; 132.5 8   17.770  5.801 *
##          23) Advertising &gt; 6.5 46  158.800  7.718  
##            46) CompPrice &lt; 121 14   27.200  6.518 *
##            47) CompPrice &gt; 121 32  102.500  8.244  
##              94) Price &lt; 124.5 18   25.190  9.296 *
##              95) Price &gt; 124.5 14   31.840  6.891 *
##     3) ShelveLoc: Good 32  167.000  9.735  
##       6) Price &lt; 146.5 27   92.560 10.330  
##        12) Price &lt; 118.5 9   11.530 11.780 *
##        13) Price &gt; 118.5 18   52.580  9.606  
##          26) CompPrice &lt; 133 11   11.550  8.635 *
##          27) CompPrice &gt; 133 7   14.360 11.130 *
##       7) Price &gt; 146.5 5   12.960  6.514 *
</code></pre><pre><code class="lang-r">y_hat &lt;- predict(rtree.carseats, newdata = Carseats[test, ])
test.MSE &lt;- mean((y_hat - Carseats[test, ]$Sales)^<span class="hljs-number">2</span>)
print(test.MSE)
</code></pre>
<pre><code>## [1] 4.477452
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Part (c): Use cross-validation to determine the optimal of tree complexity:</span>
cv.carseats &lt;- cv.tree(rtree.carseats)
names(cv.carseats)
</code></pre>
<pre><code>## [1] &quot;size&quot;   &quot;dev&quot;    &quot;k&quot;      &quot;method&quot;
</code></pre><pre><code class="lang-r">print(cv.carseats)
</code></pre>
<pre><code>## $size
##  [1] 18 17 16 15 13 12 11 10  9  8  6  5  4  3  2  1
## 
## $dev
##  [1]  837.3778  861.1636  852.3690  857.1999  848.9026  880.5561  868.5359
##  [8]  878.2036  871.2037  865.0657  863.9906  903.7486  895.1975 1092.0162
## [15] 1213.2771 1300.3878
## 
## $k
##  [1]      -Inf  15.04210  15.22571  16.39571  19.95047  22.30687  25.21139
##  [8]  26.66949  28.45630  29.66510  37.26307  52.93732  61.48054 134.73740
## [15] 176.45091 230.50903
## 
## $method
## [1] &quot;deviance&quot;
## 
## attr(,&quot;class&quot;)
## [1] &quot;prune&quot;         &quot;tree.sequence&quot;
</code></pre><pre><code class="lang-r">plot(cv.carseats$size, cv.carseats$dev, type = <span class="hljs-string">&quot;b&quot;</span>)  <span class="hljs-comment"># plot the tree size</span>
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-3-2.png" alt=""></p>
<pre><code class="lang-r"><span class="hljs-comment"># Pick the size of the tree you want to prune to: It looks like k=6 is the smallest tree with an error close to the minimum.</span>

prune.carseats &lt;- prune.tree(rtree.carseats, best = <span class="hljs-number">6</span>)

plot(prune.carseats)
text(prune.carseats, pretty = <span class="hljs-number">0</span>)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-3-3.png" alt=""></p>
<pre><code class="lang-r"><span class="hljs-comment"># Predict the MSE using this tree:</span>
y_hat &lt;- predict(prune.carseats, newdata = Carseats[test, ])
prune.MSE &lt;- mean((y_hat - Carseats[test, ]$Sales)^<span class="hljs-number">2</span>)
print(prune.MSE)
</code></pre>
<pre><code>## [1] 5.208115
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Part (d): Use bagging</span>
carseats.bag &lt;- randomForest(Sales ~ ., data = Carseats, mtry = p, ntree = <span class="hljs-number">500</span>, importance = <span class="hljs-literal">TRUE</span>, subset = train)
y_hat &lt;- predict(carseats.bag, newdata = Carseats[test, ])
mse.bag &lt;- mean((Carseats[test, ]$Sales - y_hat)^<span class="hljs-number">2</span>)
print(mse.bag)
</code></pre>
<pre><code>## [1] 2.932783
</code></pre><pre><code class="lang-r">plot(carseats.bag)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-3-4.png" alt=""></p>
<pre><code class="lang-r">ibag &lt;- importance(carseats.bag)
print(ibag[order(ibag[, <span class="hljs-number">1</span>]), ])
</code></pre>
<pre><code>##                %IncMSE IncNodePurity
## Population  -1.9984333     54.142939
## Urban       -0.6258907      7.397644
## Income       0.9075028     60.629023
## Education    2.7940569     42.414542
## US           5.2112303     10.687375
## Advertising 11.9998791     86.644936
## Age         14.5356992    118.623427
## CompPrice   21.4674924    127.767968
## ShelveLoc   49.7905463    348.452887
## Price       57.4299058    380.441111
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Part (e): Use random forests</span>
carseats.rf &lt;- randomForest(Sales ~ ., data = Carseats, ntree = <span class="hljs-number">500</span>, mtry = p/<span class="hljs-number">3</span>, importance = <span class="hljs-literal">TRUE</span>, subset = train)
y_hat &lt;- predict(carseats.rf, newdata = Carseats[test, ])
mse.rf &lt;- mean((Carseats[test, ]$Sales - y_hat)^<span class="hljs-number">2</span>)
print(mse.rf)
</code></pre>
<pre><code>## [1] 3.673223
</code></pre><pre><code class="lang-r">plot(carseats.rf)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-3-5.png" alt=""></p>
<pre><code class="lang-r">irf &lt;- importance(carseats.rf)
print(irf[order(irf[, <span class="hljs-number">1</span>]), ])
</code></pre>
<pre><code>##                %IncMSE IncNodePurity
## Population  -3.3907326      90.58748
## Urban       -1.2095544      10.28038
## Education    0.7890977      60.82180
## Income       1.9668734      93.81426
## US           2.1490545      15.16011
## CompPrice   10.8896740     114.42913
## Age         12.2675136     150.19842
## Advertising 13.9004159     114.95596
## ShelveLoc   33.1071231     259.08665
## Price       36.7085556     298.84473
</code></pre><h3 id="exercise-9">Exercise 9</h3>
<pre><code class="lang-r">set.seed(<span class="hljs-number">0</span>)

n &lt;- nrow(OJ)
p &lt;- ncol(OJ) - <span class="hljs-number">1</span>  <span class="hljs-comment"># remove the response Purchase</span>

<span class="hljs-comment"># Part (a):</span>
train &lt;- sample(<span class="hljs-number">1</span>:n, <span class="hljs-number">800</span>)
test &lt;- (<span class="hljs-number">1</span>:n)[-train]

<span class="hljs-comment"># Part (b):</span>
tree.OJ &lt;- tree(Purchase ~ ., data = OJ[train, ])
summary(tree.OJ)
</code></pre>
<pre><code>## 
## Classification tree:
## tree(formula = Purchase ~ ., data = OJ[train, ])
## Variables actually used in tree construction:
## [1] &quot;LoyalCH&quot;       &quot;SalePriceMM&quot;   &quot;ListPriceDiff&quot; &quot;PctDiscMM&quot;    
## Number of terminal nodes:  8 
## Residual mean deviance:  0.7414 = 587.2 / 792 
## Misclassification error rate: 0.1575 = 126 / 800
</code></pre><pre><code class="lang-r">print(tree.OJ)
</code></pre>
<pre><code>## node), split, n, deviance, yval, (yprob)
##       * denotes terminal node
## 
##  1) root 800 1067.00 CH ( 0.61375 0.38625 )  
##    2) LoyalCH &lt; 0.50395 346  412.40 MM ( 0.28324 0.71676 )  
##      4) LoyalCH &lt; 0.275354 160  104.00 MM ( 0.10000 0.90000 )  
##        8) LoyalCH &lt; 0.0506575 58    0.00 MM ( 0.00000 1.00000 ) *
##        9) LoyalCH &gt; 0.0506575 102   88.62 MM ( 0.15686 0.84314 ) *
##      5) LoyalCH &gt; 0.275354 186  255.20 MM ( 0.44086 0.55914 )  
##       10) SalePriceMM &lt; 2.04 99  117.90 MM ( 0.28283 0.71717 ) *
##       11) SalePriceMM &gt; 2.04 87  115.50 CH ( 0.62069 0.37931 ) *
##    3) LoyalCH &gt; 0.50395 454  358.30 CH ( 0.86564 0.13436 )  
##      6) LoyalCH &lt; 0.764572 182  214.00 CH ( 0.72527 0.27473 )  
##       12) ListPriceDiff &lt; 0.235 75  103.90 CH ( 0.52000 0.48000 )  
##         24) PctDiscMM &lt; 0.196196 59   77.94 CH ( 0.62712 0.37288 ) *
##         25) PctDiscMM &gt; 0.196196 16   12.06 MM ( 0.12500 0.87500 ) *
##       13) ListPriceDiff &gt; 0.235 107   83.03 CH ( 0.86916 0.13084 ) *
##      7) LoyalCH &gt; 0.764572 272   92.12 CH ( 0.95956 0.04044 ) *
</code></pre><pre><code class="lang-r">plot(tree.OJ)
text(tree.OJ, pretty = <span class="hljs-number">0</span>)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-4-1.png" alt=""></p>
<pre><code class="lang-r">y_hat &lt;- predict(tree.OJ, newdata = OJ[test, ], type = <span class="hljs-string">&quot;class&quot;</span>)  <span class="hljs-comment"># gives classification labels</span>
CT &lt;- table(y_hat, OJ[test, ]$Purchase)
print(CT)
</code></pre>
<pre><code>##      
## y_hat  CH  MM
##    CH 142  27
##    MM  20  81
</code></pre><pre><code class="lang-r">print(<span class="hljs-string">&quot;original tree: classificaion error rate on the test dataset:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;original tree: classificaion error rate on the test dataset:&quot;
</code></pre><pre><code class="lang-r">print((CT[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>] + CT[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>])/sum(CT))
</code></pre>
<pre><code>## [1] 0.1740741
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Part (c): Use cross-validation to determine the optimal of tree complexity:</span>
cv.OJ &lt;- cv.tree(tree.OJ)

plot(cv.OJ$size, cv.OJ$dev, type = <span class="hljs-string">&quot;b&quot;</span>)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-4-2.png" alt=""></p>
<pre><code class="lang-r"><span class="hljs-comment"># Pick the size of the tree you want to prune to:</span>

prune.OJ &lt;- prune.tree(tree.OJ, best = <span class="hljs-number">5</span>)

plot(prune.OJ)
text(prune.OJ, pretty = <span class="hljs-number">0</span>)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-4-3.png" alt=""></p>
<pre><code class="lang-r"><span class="hljs-comment"># Compute training error rates:</span>
y_hat &lt;- predict(prune.OJ, newdata = OJ[train, ], type = <span class="hljs-string">&quot;class&quot;</span>)
CT &lt;- table(y_hat, OJ[train, ]$Purchase)
print(<span class="hljs-string">&quot;pruned tree: classificaion error rate on the training dataset:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;pruned tree: classificaion error rate on the training dataset:&quot;
</code></pre><pre><code class="lang-r">print((CT[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>] + CT[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>])/sum(CT))
</code></pre>
<pre><code>## [1] 0.19875
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Compute testing error rates:</span>
y_hat &lt;- predict(prune.OJ, newdata = OJ[test, ], type = <span class="hljs-string">&quot;class&quot;</span>)
CT &lt;- table(y_hat, OJ[test, ]$Purchase)
print(<span class="hljs-string">&quot;pruned tree: classificaion error rate on the test dataset:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;pruned tree: classificaion error rate on the test dataset:&quot;
</code></pre><pre><code class="lang-r">print((CT[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>] + CT[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>])/sum(CT))
</code></pre>
<pre><code>## [1] 0.2037037
</code></pre><h3 id="exercise-10">Exercise 10</h3>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(gbm)
</code></pre>
<pre><code>## Loading required package: survival
## Loading required package: lattice
## Loading required package: splines
## Loading required package: parallel
## Loaded gbm 2.1.1
</code></pre><pre><code class="lang-r"><span class="hljs-keyword">library</span>(glmnet)
</code></pre>
<pre><code>## Loading required package: Matrix
## Loading required package: foreach
## Loaded glmnet 2.0-2
</code></pre><pre><code class="lang-r">set.seed(<span class="hljs-number">0</span>)

Hitters &lt;- na.omit(Hitters)
Hitters$Salary &lt;- log(Hitters$Salary)

n &lt;- nrow(Hitters)
p &lt;- ncol(Hitters) - <span class="hljs-number">1</span>  <span class="hljs-comment"># one column is the response we are trying to model i.e. &apos;Salary&apos; </span>

train &lt;- <span class="hljs-number">1</span>:<span class="hljs-number">200</span>
test &lt;- <span class="hljs-number">201</span>:n

lambda_set &lt;- seq(<span class="hljs-number">1e-04</span>, <span class="hljs-number">0.04</span>, by = <span class="hljs-number">0.001</span>)

<span class="hljs-comment"># </span>
training_set_mse &lt;- rep(<span class="hljs-literal">NA</span>, length(lambda_set))
test_set_mse &lt;- rep(<span class="hljs-literal">NA</span>, length(lambda_set))
<span class="hljs-keyword">for</span> (lmi <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(lambda_set)) {
    lm &lt;- lambda_set[lmi]

    boost.hitters &lt;- gbm(Salary ~ ., data = Hitters[train, ], distribution = <span class="hljs-string">&quot;gaussian&quot;</span>, n.trees = <span class="hljs-number">1000</span>, interaction.depth = <span class="hljs-number">4</span>, shrinkage = lm)

    y_hat &lt;- predict(boost.hitters, newdata = Hitters[train, ], n.trees = <span class="hljs-number">1000</span>)
    training_set_mse[lmi] &lt;- mean((y_hat - Hitters[train, ]$Salary)^<span class="hljs-number">2</span>)

    y_hat &lt;- predict(boost.hitters, newdata = Hitters[test, ], n.trees = <span class="hljs-number">1000</span>)
    test_set_mse[lmi] &lt;- mean((y_hat - Hitters[test, ]$Salary)^<span class="hljs-number">2</span>)
}

plot(lambda_set, training_set_mse, type = <span class="hljs-string">&quot;b&quot;</span>, pch = <span class="hljs-number">19</span>, col = <span class="hljs-string">&quot;red&quot;</span>, xlab = <span class="hljs-string">&quot;Lambda Value&quot;</span>, ylab = <span class="hljs-string">&quot;MSE&quot;</span>)
lines(lambda_set, test_set_mse, type = <span class="hljs-string">&quot;b&quot;</span>, pch = <span class="hljs-number">19</span>, col = <span class="hljs-string">&quot;green&quot;</span>, xlab = <span class="hljs-string">&quot;Lambda Value&quot;</span>, ylab = <span class="hljs-string">&quot;Test Set MSE&quot;</span>)
grid()
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-5-1.png" alt=""></p>
<pre><code class="lang-r"><span class="hljs-comment"># Looks like the test MSE results are insensitive to the exact value of lambda as long as its small enough:</span>
lm &lt;- <span class="hljs-number">0.01</span>
boost.hitters &lt;- gbm(Salary ~ ., data = Hitters[train, ], distribution = <span class="hljs-string">&quot;gaussian&quot;</span>, n.trees = <span class="hljs-number">1000</span>, interaction.depth = <span class="hljs-number">4</span>, shrinkage = lm)
y_hat &lt;- predict(boost.hitters, newdata = Hitters[test, ], n.trees = <span class="hljs-number">1000</span>)
print(<span class="hljs-string">&quot;regression boosting test MSE:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;regression boosting test MSE:&quot;
</code></pre><pre><code class="lang-r">print(mean((y_hat - Hitters[test, ]$Salary)^<span class="hljs-number">2</span>))
</code></pre>
<pre><code>## [1] 0.2756909
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Try linear regression:</span>
m &lt;- lm(Salary ~ ., data = Hitters[train, ])
y_hat &lt;- predict(m, newdata = Hitters[test, ])
print(<span class="hljs-string">&quot;linear regression test MSE:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;linear regression test MSE:&quot;
</code></pre><pre><code class="lang-r">print(mean((y_hat - Hitters[test, ]$Salary)^<span class="hljs-number">2</span>))
</code></pre>
<pre><code>## [1] 0.4917959
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Try the lasso:</span>
MM &lt;- model.matrix(Salary ~ ., data = Hitters[train, ])
cv.out &lt;- cv.glmnet(MM, Hitters[train, ]$Salary, alpha = <span class="hljs-number">1</span>)
bestlam &lt;- cv.out$lambda.1se
print(<span class="hljs-string">&quot;lasso CV best value of lambda (one standard error)&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;lasso CV best value of lambda (one standard error)&quot;
</code></pre><pre><code class="lang-r">print(bestlam)
</code></pre>
<pre><code>## [1] 0.1571939
</code></pre><pre><code class="lang-r">lasso.mod &lt;- glmnet(MM, Hitters[train, ]$Salary, alpha = <span class="hljs-number">1</span>)

MM_test &lt;- model.matrix(Salary ~ ., data = Hitters[test, ])
y_hat &lt;- predict(lasso.mod, s = bestlam, newx = MM_test)
print(<span class="hljs-string">&quot;lasso regression test MSE:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;lasso regression test MSE:&quot;
</code></pre><pre><code class="lang-r">print(mean((y_hat - Hitters[test, ]$Salary)^<span class="hljs-number">2</span>))
</code></pre>
<pre><code>## [1] 0.4382486
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Try ridge regression:</span>
cv.out &lt;- cv.glmnet(MM, Hitters[train, ]$Salary, alpha = <span class="hljs-number">0</span>)
plot(cv.out)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-5-2.png" alt=""></p>
<pre><code class="lang-r">bestlam &lt;- cv.out$lambda.1se
print(<span class="hljs-string">&quot;ridge CV best value of lambda (one standard error)&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;ridge CV best value of lambda (one standard error)&quot;
</code></pre><pre><code class="lang-r">print(bestlam)
</code></pre>
<pre><code>## [1] 3.46633
</code></pre><pre><code class="lang-r">ridge.mod &lt;- glmnet(MM, Hitters[train, ]$Salary, alpha = <span class="hljs-number">0</span>)
Y_hat &lt;- predict(ridge.mod, s = bestlam, newx = MM_test)
print(<span class="hljs-string">&quot;ridge regression test MSE:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;ridge regression test MSE:&quot;
</code></pre><pre><code class="lang-r">print(mean((y_hat - Hitters[test, ]$Salary)^<span class="hljs-number">2</span>))
</code></pre>
<pre><code>## [1] 0.4382486
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># What are the most important variables:</span>
summary(boost.hitters)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-5-3.png" alt=""></p>
<pre><code>##                 var    rel.inf
## CAtBat       CAtBat 27.9843348
## CHits         CHits  9.7163571
## CRBI           CRBI  9.3564948
## CWalks       CWalks  8.4641693
## CRuns         CRuns  7.2820304
## Years         Years  5.4674280
## PutOuts     PutOuts  4.5604591
## Walks         Walks  4.3724216
## AtBat         AtBat  4.0692012
## CHmRun       CHmRun  3.6759612
## Assists     Assists  3.1511172
## RBI             RBI  2.6630040
## Errors       Errors  2.2909979
## Hits           Hits  2.2133744
## HmRun         HmRun  1.7480868
## Runs           Runs  1.5973072
## NewLeague NewLeague  0.6577638
## Division   Division  0.5252455
## League       League  0.2042459
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Try randomForests on the Hitters dataset (not asked for in the problem statement):</span>
rf.hitters &lt;- randomForest(Salary ~ ., data = Hitters, mtry = p/<span class="hljs-number">3</span>, ntree = <span class="hljs-number">1000</span>, importance = <span class="hljs-literal">TRUE</span>, subset = train)
y_hat &lt;- predict(rf.hitters, newdata = Hitters[test, ])
mse.rf &lt;- mean((Hitters[test, ]$Salary - y_hat)^<span class="hljs-number">2</span>)
print(<span class="hljs-string">&quot;randomForest test MSE:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;randomForest test MSE:&quot;
</code></pre><pre><code class="lang-r">print(mse.rf)
</code></pre>
<pre><code>## [1] 0.2171106
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Try BAGGING on the Hitters dataset:</span>
bag.hitters &lt;- randomForest(Salary ~ ., data = Hitters, mtry = p, ntree = <span class="hljs-number">1000</span>, importance = <span class="hljs-literal">TRUE</span>, subset = train)
y_hat &lt;- predict(bag.hitters, newdata = Hitters[test, ])
mse.bag &lt;- mean((Hitters[test, ]$Salary - y_hat)^<span class="hljs-number">2</span>)
print(<span class="hljs-string">&quot;Bagging test MSE:&quot;</span>)
</code></pre>
<pre><code>## [1] &quot;Bagging test MSE:&quot;
</code></pre><pre><code class="lang-r">print(mse.bag)
</code></pre>
<pre><code>## [1] 0.2342413
</code></pre><h3 id="exercise-11">Exercise 11</h3>
<pre><code class="lang-r">set.seed(<span class="hljs-number">0</span>)

Caravan &lt;- na.omit(Caravan)

n &lt;- nrow(Caravan)
p &lt;- ncol(Caravan) - <span class="hljs-number">1</span>  <span class="hljs-comment"># one column is the response we are trying to model i.e. &apos;Purchase&apos; </span>

train &lt;- <span class="hljs-number">1</span>:<span class="hljs-number">1000</span>
test &lt;- <span class="hljs-number">1001</span>:n

<span class="hljs-comment"># Transform the response &apos;Purchase&apos; to be in [0,1] as required by gbm:</span>
PurchaseBinary &lt;- rep(<span class="hljs-number">0</span>, n)
PurchaseBinary[Caravan$Purchase == <span class="hljs-string">&quot;Yes&quot;</span>] &lt;- <span class="hljs-number">1</span>
Caravan$Purchase &lt;- PurchaseBinary

<span class="hljs-comment"># Some variables seem to be very noninformative (have zero variance as reported by gbm):</span>
Caravan$PVRAAUT &lt;- <span class="hljs-literal">NULL</span>
Caravan$AVRAAUT &lt;- <span class="hljs-literal">NULL</span>

<span class="hljs-comment"># Train a gbm:</span>
lm &lt;- <span class="hljs-number">0.01</span>
boost.caravan &lt;- gbm(Purchase ~ ., data = Caravan[train, ], distribution = <span class="hljs-string">&quot;bernoulli&quot;</span>, n.trees = <span class="hljs-number">1000</span>, interaction.depth = <span class="hljs-number">2</span>, shrinkage = lm)
summary(boost.caravan)
</code></pre>
<p><img src="solutions_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-6-1.png" alt=""></p>
<pre><code>##               var    rel.inf
## PPERSAUT PPERSAUT 9.83047713
## MKOOPKLA MKOOPKLA 5.67101078
## MOPLHOOG MOPLHOOG 5.57015086
## PBRAND     PBRAND 5.53090647
## MGODGE     MGODGE 5.50146339
## MBERMIDD MBERMIDD 4.66053217
## MOSTYPE   MOSTYPE 3.71528842
## MINK3045 MINK3045 3.29167392
## MGODPR     MGODPR 3.15189659
## MAUT2       MAUT2 2.75860820
## MBERARBG MBERARBG 2.41585129
## ABRAND     ABRAND 2.34750399
## MSKC         MSKC 2.07742330
## MSKA         MSKA 2.03539655
## MAUT1       MAUT1 2.00290825
## MRELGE     MRELGE 1.91903070
## MSKB1       MSKB1 1.88713704
## PWAPART   PWAPART 1.88354710
## MFWEKIND MFWEKIND 1.86568208
## MGODOV     MGODOV 1.75362888
## MINK7512 MINK7512 1.68185238
## MFGEKIND MFGEKIND 1.62053883
## MBERHOOG MBERHOOG 1.47386158
## MBERARBO MBERARBO 1.45496977
## MINKM30   MINKM30 1.45332376
## MHKOOP     MHKOOP 1.44894919
## MGODRK     MGODRK 1.42859782
## MRELOV     MRELOV 1.35136073
## MINKGEM   MINKGEM 1.33514219
## MAUT0       MAUT0 1.20352717
## MZFONDS   MZFONDS 1.17292916
## MINK4575 MINK4575 1.16903944
## MOSHOOFD MOSHOOFD 1.13985697
## MHHUUR     MHHUUR 1.04951077
## MGEMLEEF MGEMLEEF 1.03005616
## APERSAUT APERSAUT 0.99864198
## MSKB2       MSKB2 0.97672510
## PBYSTAND PBYSTAND 0.87858256
## MOPLMIDD MOPLMIDD 0.87431940
## PMOTSCO   PMOTSCO 0.83289524
## MFALLEEN MFALLEEN 0.82850043
## MZPART     MZPART 0.82588303
## PLEVEN     PLEVEN 0.72568141
## MGEMOMV   MGEMOMV 0.70719044
## MSKD         MSKD 0.69605715
## MBERBOER MBERBOER 0.63402319
## MBERZELF MBERZELF 0.38036763
## MRELSA     MRELSA 0.32946406
## MINK123M MINK123M 0.21200829
## MOPLLAAG MOPLLAAG 0.19163868
## MAANTHUI MAANTHUI 0.02438834
## PWABEDR   PWABEDR 0.00000000
## PWALAND   PWALAND 0.00000000
## PBESAUT   PBESAUT 0.00000000
## PAANHANG PAANHANG 0.00000000
## PTRACTOR PTRACTOR 0.00000000
## PWERKT     PWERKT 0.00000000
## PBROM       PBROM 0.00000000
## PPERSONG PPERSONG 0.00000000
## PGEZONG   PGEZONG 0.00000000
## PWAOREG   PWAOREG 0.00000000
## PZEILPL   PZEILPL 0.00000000
## PPLEZIER PPLEZIER 0.00000000
## PFIETS     PFIETS 0.00000000
## PINBOED   PINBOED 0.00000000
## AWAPART   AWAPART 0.00000000
## AWABEDR   AWABEDR 0.00000000
## AWALAND   AWALAND 0.00000000
## ABESAUT   ABESAUT 0.00000000
## AMOTSCO   AMOTSCO 0.00000000
## AAANHANG AAANHANG 0.00000000
## ATRACTOR ATRACTOR 0.00000000
## AWERKT     AWERKT 0.00000000
## ABROM       ABROM 0.00000000
## ALEVEN     ALEVEN 0.00000000
## APERSONG APERSONG 0.00000000
## AGEZONG   AGEZONG 0.00000000
## AWAOREG   AWAOREG 0.00000000
## AZEILPL   AZEILPL 0.00000000
## APLEZIER APLEZIER 0.00000000
## AFIETS     AFIETS 0.00000000
## AINBOED   AINBOED 0.00000000
## ABYSTAND ABYSTAND 0.00000000
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Predict the testing error:</span>
y_hat &lt;- predict(boost.caravan, newdata = Caravan[test, ], n.trees = <span class="hljs-number">1000</span>)
p_hat &lt;- exp(y_hat)/(<span class="hljs-number">1</span> + exp(y_hat))  <span class="hljs-comment"># convert the logodd output into probabilities </span>

will_buy &lt;- rep(<span class="hljs-number">0</span>, length(test))
will_buy[p_hat &gt; <span class="hljs-number">0.2</span>] &lt;- <span class="hljs-number">1</span>

<span class="hljs-comment"># Create a confusion matrix:</span>
table(will_buy, Caravan[test, ]$Purchase)
</code></pre>
<pre><code>##         
## will_buy    0    1
##        0 4357  253
##        1  176   36
</code></pre><pre><code class="lang-r"><span class="hljs-comment"># Train a logistic regression:</span>
lr_model &lt;- glm(Purchase ~ ., data = Caravan[train, ], family = <span class="hljs-string">&quot;binomial&quot;</span>)
</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
</code></pre><pre><code class="lang-r">y_hat &lt;- predict(lr_model, newdata = Caravan[test, ])
</code></pre>
<pre><code>## Warning in predict.lm(object, newdata, se.fit, scale = 1, type =
## ifelse(type == : prediction from a rank-deficient fit may be misleading
</code></pre><pre><code class="lang-r">p_hat &lt;- exp(y_hat)/(<span class="hljs-number">1</span> + exp(y_hat))  <span class="hljs-comment"># convert the logodd output into probabilities </span>

will_buy &lt;- rep(<span class="hljs-number">0</span>, length(test))
will_buy[p_hat &gt; <span class="hljs-number">0.2</span>] &lt;- <span class="hljs-number">1</span>

<span class="hljs-comment"># Create a confusion matrix:</span>
table(will_buy, Caravan[test, ]$Purchase)
</code></pre>
<pre><code>##         
## will_buy    0    1
##        0 4183  231
##        1  350   58
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../chapter8/lab.html" class="navigation navigation-prev " aria-label="Previous page: Lab"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../chapter9/index.html" class="navigation navigation-next " aria-label="Next page: Chapter 9. Support Vector Machines"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
