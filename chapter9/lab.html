<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Lab | An Introduction to Statistical Learning:</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.2.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../chapter9/solutions.html" />
    
    
    <link rel="prev" href="../chapter9/index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="8.1" data-basepath=".." data-revision="Wed Aug 19 2015 19:44:06 GMT+0100 (BST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="chapter2/index.html">
            
                
                    <a href="../chapter2/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Chapter 2. Statistical Learning
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="chapter2/lab.html">
            
                
                    <a href="../chapter2/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="chapter2/solutions.html">
            
                
                    <a href="../chapter2/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="chapter3/index.html">
            
                
                    <a href="../chapter3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Chapter 3. Linear Regression
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="chapter3/lab.html">
            
                
                    <a href="../chapter3/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="chapter3/solutions.html">
            
                
                    <a href="../chapter3/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="chapter4/index.html">
            
                
                    <a href="../chapter4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Chapter 4. Classification
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="chapter4/lab.html">
            
                
                    <a href="../chapter4/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="chapter4/solutions.html">
            
                
                    <a href="../chapter4/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="chapter5/index.html">
            
                
                    <a href="../chapter5/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Chapter 5. Resampling Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="chapter5/lab.html">
            
                
                    <a href="../chapter5/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="chapter5/solutions.html">
            
                
                    <a href="../chapter5/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="chapter6/index.html">
            
                
                    <a href="../chapter6/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Chapter 6. Linear Model Selection and Regularization
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="chapter6/lab.html">
            
                
                    <a href="../chapter6/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="chapter6/solutions.html">
            
                
                    <a href="../chapter6/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="chapter7/index.html">
            
                
                    <a href="../chapter7/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Chapter 7. Moving Beyond Linearity
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="chapter7/lab.html">
            
                
                    <a href="../chapter7/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="chapter7/solutions.html">
            
                
                    <a href="../chapter7/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="chapter8/index.html">
            
                
                    <a href="../chapter8/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Chapter 8. Tree-Based Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="chapter8/lab.html">
            
                
                    <a href="../chapter8/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="chapter8/solutions.html">
            
                
                    <a href="../chapter8/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="chapter9/index.html">
            
                
                    <a href="../chapter9/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Chapter 9. Support Vector Machines
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="8.1" data-path="chapter9/lab.html">
            
                
                    <a href="../chapter9/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="chapter9/solutions.html">
            
                
                    <a href="../chapter9/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="chapter10/index.html">
            
                
                    <a href="../chapter10/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Chapter 10. Unsupervised Learning
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="chapter10/lab.html">
            
                
                    <a href="../chapter10/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="chapter10/solutions.html">
            
                
                    <a href="../chapter10/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="references.html">
            
                
                    <a href="../references.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        References
                    </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >An Introduction to Statistical Learning:</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="9-6-lab-support-vector-machines">9.6 Lab: Support Vector Machines</h2>
<h3 id="9-6-1-support-vector-classifier">9.6.1 Support Vector Classifier</h3>
<p>In this exercise we will use a support vector classifier with a linear kernel. We start by generating observations from two classes using the <a href="http://bit.ly/R_normal" target="_blank"><code>rnorm()</code></a> function.</p>
<pre><code class="lang-r">set.seed(<span class="hljs-number">1</span>)
x &lt;- matrix(rnorm(<span class="hljs-number">20</span> * <span class="hljs-number">2</span>), ncol = <span class="hljs-number">2</span>)
y &lt;- c(rep(-<span class="hljs-number">1</span>, <span class="hljs-number">10</span>), rep(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
x[y == <span class="hljs-number">1</span>, ] &lt;- x[y == <span class="hljs-number">1</span>, ] + <span class="hljs-number">1</span>
</code></pre>
<pre><code class="lang-r">plot(x, col = (<span class="hljs-number">3</span> - y))
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-2-1.png" alt=""></p>
<p>The <code>e1071</code> package provides functionality to fit a Support Vector Machine classifier.</p>
<pre><code class="lang-r">dat &lt;- data.frame(x = x, y = as.factor(y))
<span class="hljs-keyword">library</span>(e1071)
svmfit &lt;- svm(y ~ ., data = dat, kernel = <span class="hljs-string">&quot;linear&quot;</span>, cost = <span class="hljs-number">10</span>, scale = <span class="hljs-literal">FALSE</span>)
</code></pre>
<p>The fitted model from the <a href="http://bit.ly/R_svm" target="_blank"><code>svm()</code></a> function can be plotted with <a href="http://bit.ly/R_plot" target="_blank"><code>plot()</code></a>.</p>
<pre><code class="lang-r">plot(svmfit, dat)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-4-1.png" alt=""></p>
<p>We can inspect the support vectors with the <code>index</code> component of the classifier returned from <a href="http://bit.ly/R_svm" target="_blank"><code>svm()</code></a>.</p>
<pre><code class="lang-r">svmfit$index
</code></pre>
<pre><code>## [1]  1  2  5  7 14 16 17
</code></pre><p>The <a href="http://bit.ly/R_summary" target="_blank"><code>summary()</code></a> function can be used to print a summary of the classifier.</p>
<pre><code class="lang-r">summary(svmfit)
</code></pre>
<pre><code>## 
## Call:
## svm(formula = y ~ ., data = dat, kernel = &quot;linear&quot;, cost = 10, 
##     scale = FALSE)
## 
## 
## Parameters:
##    SVM-Type:  C-classification 
##  SVM-Kernel:  linear 
##        cost:  10 
##       gamma:  0.5 
## 
## Number of Support Vectors:  7
## 
##  ( 4 3 )
## 
## 
## Number of Classes:  2 
## 
## Levels: 
##  -1 1
</code></pre><p>We can change the <code>cost</code> parameter and re-run the classifier to see how the support vectors change.</p>
<pre><code class="lang-r">svmfit &lt;- svm(y ~ ., data = dat, kernel = <span class="hljs-string">&quot;linear&quot;</span>, cost = <span class="hljs-number">0.1</span>, scale = <span class="hljs-literal">FALSE</span>)
plot(svmfit, dat)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-7-1.png" alt=""></p>
<pre><code class="lang-r">svmfit$index
</code></pre>
<pre><code>##  [1]  1  2  3  4  5  7  9 10 12 13 14 15 16 17 18 20
</code></pre><p>We can run cross-validation on a range of values for the <code>cost</code> parameter using the <a href="http://bit.ly/R_tune" target="_blank"><code>tune()</code></a> function.</p>
<pre><code class="lang-r">set.seed(<span class="hljs-number">1</span>)
tune.out &lt;- tune(svm, y ~ ., data = dat, kernel = <span class="hljs-string">&quot;linear&quot;</span>, ranges = list(cost = c(<span class="hljs-number">0.001</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)))
</code></pre>
<pre><code class="lang-r">summary(tune.out)
</code></pre>
<pre><code>## 
## Parameter tuning of &apos;svm&apos;:
## 
## - sampling method: 10-fold cross validation 
## 
## - best parameters:
##  cost
##   0.1
## 
## - best performance: 0.1 
## 
## - Detailed performance results:
##    cost error dispersion
## 1 1e-03  0.70  0.4216370
## 2 1e-02  0.70  0.4216370
## 3 1e-01  0.10  0.2108185
## 4 1e+00  0.15  0.2415229
## 5 5e+00  0.15  0.2415229
## 6 1e+01  0.15  0.2415229
## 7 1e+02  0.15  0.2415229
</code></pre><p>The best performing model is stored in the <code>best.model</code> component of the object returned from <a href="http://bit.ly/R_tune" target="_blank"><code>tune()</code></a>.</p>
<pre><code class="lang-r">bestmod &lt;- tune.out$best.model
summary(bestmod)
</code></pre>
<pre><code>## 
## Call:
## best.tune(method = svm, train.x = y ~ ., data = dat, ranges = list(cost = c(0.001, 
##     0.01, 0.1, 1, 5, 10, 100)), kernel = &quot;linear&quot;)
## 
## 
## Parameters:
##    SVM-Type:  C-classification 
##  SVM-Kernel:  linear 
##        cost:  0.1 
##       gamma:  0.5 
## 
## Number of Support Vectors:  16
## 
##  ( 8 8 )
## 
## 
## Number of Classes:  2 
## 
## Levels: 
##  -1 1
</code></pre><p>We can also classify a different set of observations using the best model obtained from <a href="http://bit.ly/R_tune" target="_blank"><code>tune()</code></a>. First we create a new set of observations with the <a href="http://bit.ly/R_normal" target="_blank"><code>rnorm()</code></a> function.</p>
<pre><code class="lang-r">xtest &lt;- matrix(rnorm(<span class="hljs-number">20</span> * <span class="hljs-number">2</span>), ncol = <span class="hljs-number">2</span>)
ytest &lt;- sample(c(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <span class="hljs-number">20</span>, rep = <span class="hljs-literal">TRUE</span>)
xtest[ytest == <span class="hljs-number">1</span>, ] &lt;- xtest[ytest == <span class="hljs-number">1</span>, ] + <span class="hljs-number">1</span>
testdat &lt;- data.frame(x = xtest, y = as.factor(ytest))
</code></pre>
<p>We can then use the <a href="http://bit.ly/R_predict" target="_blank"><code>predict()</code></a> function to classify the observations in <code>testdat</code>.</p>
<pre><code class="lang-r">ypred &lt;- predict(bestmod, testdat)
table(predict = ypred, truth = testdat$y)
</code></pre>
<pre><code>##        truth
## predict -1  1
##      -1 11  1
##      1   0  8
</code></pre><p>We can also try a different value for the <code>cost</code> parameter and train the classifier again.</p>
<pre><code class="lang-r">svmfit &lt;- svm(y ~ ., data = dat, kernel = <span class="hljs-string">&quot;linear&quot;</span>, cost = <span class="hljs-number">0.01</span>, scale = <span class="hljs-literal">FALSE</span>)
ypred &lt;- predict(svmfit, testdat)
table(predict = ypred, truth = testdat$y)
</code></pre>
<pre><code>##        truth
## predict -1  1
##      -1 11  2
##      1   0  7
</code></pre><p>We can linearly separate the two classes and plot the observations.</p>
<pre><code class="lang-r">x[y == <span class="hljs-number">1</span>, ] &lt;- x[y == <span class="hljs-number">1</span>, ] + <span class="hljs-number">0.5</span>
plot(x, col = (y + <span class="hljs-number">5</span>)/<span class="hljs-number">2</span>, pch = <span class="hljs-number">19</span>)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-14-1.png" alt=""></p>
<p>We can fit a classifier with a large value for the <code>cost</code> parameter to see how the observations are classified.</p>
<pre><code class="lang-r">dat &lt;- data.frame(x = x, y = as.factor(y))
svmfit &lt;- svm(y ~ ., data = dat, kernel = <span class="hljs-string">&quot;linear&quot;</span>, cost = <span class="hljs-number">1e+05</span>)
summary(svmfit)
</code></pre>
<pre><code>## 
## Call:
## svm(formula = y ~ ., data = dat, kernel = &quot;linear&quot;, cost = 1e+05)
## 
## 
## Parameters:
##    SVM-Type:  C-classification 
##  SVM-Kernel:  linear 
##        cost:  1e+05 
##       gamma:  0.5 
## 
## Number of Support Vectors:  3
## 
##  ( 1 2 )
## 
## 
## Number of Classes:  2 
## 
## Levels: 
##  -1 1
</code></pre><pre><code class="lang-r">plot(svmfit, dat)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-15-1.png" alt=""></p>
<p>We can also try with a a smaller <code>cost</code> value.</p>
<pre><code class="lang-r">svmfit &lt;- svm(y ~ ., data = dat, kernel = <span class="hljs-string">&quot;linear&quot;</span>, cost = <span class="hljs-number">1</span>)
summary(svmfit)
</code></pre>
<pre><code>## 
## Call:
## svm(formula = y ~ ., data = dat, kernel = &quot;linear&quot;, cost = 1)
## 
## 
## Parameters:
##    SVM-Type:  C-classification 
##  SVM-Kernel:  linear 
##        cost:  1 
##       gamma:  0.5 
## 
## Number of Support Vectors:  7
## 
##  ( 4 3 )
## 
## 
## Number of Classes:  2 
## 
## Levels: 
##  -1 1
</code></pre><pre><code class="lang-r">plot(svmfit, dat)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-16-1.png" alt=""></p>
<h3 id="9-6-2-support-vector-machine">9.6.2 Support Vector Machine</h3>
<p>We begin by generating data with non-linear class boundaries.</p>
<pre><code class="lang-r">set.seed(<span class="hljs-number">1</span>)
x &lt;- matrix(rnorm(<span class="hljs-number">200</span> * <span class="hljs-number">2</span>), ncol = <span class="hljs-number">2</span>)
x[<span class="hljs-number">1</span>:<span class="hljs-number">100</span>, ] &lt;- x[<span class="hljs-number">1</span>:<span class="hljs-number">100</span>, ] + <span class="hljs-number">2</span>
x[<span class="hljs-number">101</span>:<span class="hljs-number">150</span>, ] &lt;- x[<span class="hljs-number">101</span>:<span class="hljs-number">150</span>, ] - <span class="hljs-number">2</span>
y &lt;- c(rep(<span class="hljs-number">1</span>, <span class="hljs-number">150</span>), rep(<span class="hljs-number">2</span>, <span class="hljs-number">50</span>))
dat &lt;- data.frame(x = x, y = as.factor(y))
</code></pre>
<p>We can verify that the class boundaries are not linear by plotting the observations.</p>
<pre><code class="lang-r">plot(x, col = y)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-18-1.png" alt=""></p>
<p>We split the data into training and test subsets and run the SVM classifier with <code>kernel = &quot;radial&quot;</code> parameter.</p>
<pre><code class="lang-r">train &lt;- sample(<span class="hljs-number">200</span>, <span class="hljs-number">100</span>)
svmfit &lt;- svm(y ~ ., data = dat[train, ], kernel = <span class="hljs-string">&quot;radial&quot;</span>, gamma = <span class="hljs-number">1</span>, cost = <span class="hljs-number">1</span>)
plot(svmfit, dat[train, ])
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-19-1.png" alt=""></p>
<p>We can examine the model fit with the <a href="http://bit.ly/R_summary" target="_blank"><code>summary()</code></a> function.</p>
<pre><code class="lang-r">summary(svmfit)
</code></pre>
<pre><code>## 
## Call:
## svm(formula = y ~ ., data = dat[train, ], kernel = &quot;radial&quot;, 
##     gamma = 1, cost = 1)
## 
## 
## Parameters:
##    SVM-Type:  C-classification 
##  SVM-Kernel:  radial 
##        cost:  1 
##       gamma:  1 
## 
## Number of Support Vectors:  37
## 
##  ( 17 20 )
## 
## 
## Number of Classes:  2 
## 
## Levels: 
##  1 2
</code></pre><p>We can use a larger value for the <code>cost</code> parameter and see if it reduces the training errors.</p>
<pre><code class="lang-r">svmfit &lt;- svm(y ~ ., data = dat[train, ], kernel = <span class="hljs-string">&quot;radial&quot;</span>, gamma = <span class="hljs-number">1</span>, cost = <span class="hljs-number">1e+05</span>)
plot(svmfit, dat[train, ])
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-21-1.png" alt=""></p>
<p>We can run cross-validation using the <a href="http://bit.ly/R_tune" target="_blank"><code>tune()</code></a> function.</p>
<pre><code class="lang-r">set.seed(<span class="hljs-number">1</span>)
tune.out &lt;- tune(svm, y ~ ., data = dat[train, ], kernel = <span class="hljs-string">&quot;radial&quot;</span>, ranges = list(cost = c(<span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>, <span class="hljs-number">1000</span>), gamma = c(<span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)))
summary(tune.out)
</code></pre>
<pre><code>## 
## Parameter tuning of &apos;svm&apos;:
## 
## - sampling method: 10-fold cross validation 
## 
## - best parameters:
##  cost gamma
##     1     2
## 
## - best performance: 0.12 
## 
## - Detailed performance results:
##     cost gamma error dispersion
## 1  1e-01   0.5  0.27 0.11595018
## 2  1e+00   0.5  0.13 0.08232726
## 3  1e+01   0.5  0.15 0.07071068
## 4  1e+02   0.5  0.17 0.08232726
## 5  1e+03   0.5  0.21 0.09944289
## 6  1e-01   1.0  0.25 0.13540064
## 7  1e+00   1.0  0.13 0.08232726
## 8  1e+01   1.0  0.16 0.06992059
## 9  1e+02   1.0  0.20 0.09428090
## 10 1e+03   1.0  0.20 0.08164966
## 11 1e-01   2.0  0.25 0.12692955
## 12 1e+00   2.0  0.12 0.09189366
## 13 1e+01   2.0  0.17 0.09486833
## 14 1e+02   2.0  0.19 0.09944289
## 15 1e+03   2.0  0.20 0.09428090
## 16 1e-01   3.0  0.27 0.11595018
## 17 1e+00   3.0  0.13 0.09486833
## 18 1e+01   3.0  0.18 0.10327956
## 19 1e+02   3.0  0.21 0.08755950
## 20 1e+03   3.0  0.22 0.10327956
## 21 1e-01   4.0  0.27 0.11595018
## 22 1e+00   4.0  0.15 0.10801234
## 23 1e+01   4.0  0.18 0.11352924
## 24 1e+02   4.0  0.21 0.08755950
## 25 1e+03   4.0  0.24 0.10749677
</code></pre><p>We can predict the classes on the test subset and examine the number of observations misclassified.</p>
<pre><code class="lang-r">table(true = dat[-train, <span class="hljs-string">&quot;y&quot;</span>], pred = predict(tune.out$best.model, newdata = dat[-train, ]))
</code></pre>
<pre><code>##     pred
## true  1  2
##    1 74  3
##    2  7 16
</code></pre><h3 id="9-6-3-roc-curves">9.6.3 ROC Curves</h3>
<p>We use the <code>ROCR</code> package to produce ROC curves on the predictions from the test subset.</p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(ROCR)
</code></pre>
<pre><code>## Loading required package: gplots
## 
## Attaching package: &apos;gplots&apos;
## 
## The following object is masked from &apos;package:stats&apos;:
## 
##     lowess
</code></pre><pre><code class="lang-r">rocplot &lt;- <span class="hljs-keyword">function</span>(pred, truth, <span class="hljs-keyword">...</span>) {
    predob &lt;- prediction(pred, truth)
    perf &lt;- performance(predob, <span class="hljs-string">&quot;tpr&quot;</span>, <span class="hljs-string">&quot;fpr&quot;</span>)
    plot(perf, <span class="hljs-keyword">...</span>)
}
</code></pre>
<p>Instead of getting the class labels, we can also get fitted values from <a href="http://bit.ly/R_svm" target="_blank"><code>svm()</code></a> using <code>decision.values = TRUE</code> parameter.</p>
<pre><code class="lang-r">svmfit.opt &lt;- svm(y ~ ., data = dat[train, ], kernel = <span class="hljs-string">&quot;radial&quot;</span>, gamma = <span class="hljs-number">2</span>, cost = <span class="hljs-number">1</span>, decision.values = <span class="hljs-literal">TRUE</span>)
fitted &lt;- attributes(predict(svmfit.opt, dat[train, ], decision.values = <span class="hljs-literal">TRUE</span>))$decision.values
</code></pre>
<p>We generate the ROC curve with the <a href="http://bit.ly/R_roc_plot" target="_blank"><code>rocplot()</code></a> function. We can also change the value of (\gamma) and see if it improves our predictions.</p>
<pre><code class="lang-r">par(mfrow = c(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))
rocplot(fitted, dat[train, <span class="hljs-string">&quot;y&quot;</span>], main = <span class="hljs-string">&quot;Training Data&quot;</span>)

svmfit.flex &lt;- svm(y ~ ., data = dat[train, ], kernel = <span class="hljs-string">&quot;radial&quot;</span>, gamma = <span class="hljs-number">50</span>, cost = <span class="hljs-number">1</span>, decision.values = <span class="hljs-literal">TRUE</span>)
fitted &lt;- attributes(predict(svmfit.flex, dat[train, ], decision.values = <span class="hljs-literal">T</span>))$decision.values
rocplot(fitted, dat[train, <span class="hljs-string">&quot;y&quot;</span>], add = <span class="hljs-literal">T</span>, col = <span class="hljs-string">&quot;red&quot;</span>)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-26-1.png" alt=""></p>
<pre><code class="lang-r">fitted &lt;- attributes(predict(svmfit.opt, dat[-train, ], decision.values = <span class="hljs-literal">T</span>))$decision.values
rocplot(fitted, dat[-train, <span class="hljs-string">&quot;y&quot;</span>], main = <span class="hljs-string">&quot;Test Data&quot;</span>)
fitted &lt;- attributes(predict(svmfit.flex, dat[-train, ], decision.values = <span class="hljs-literal">T</span>))$decision.values
rocplot(fitted, dat[-train, <span class="hljs-string">&quot;y&quot;</span>], add = <span class="hljs-literal">T</span>, col = <span class="hljs-string">&quot;red&quot;</span>)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-27-1.png" alt=""></p>
<h3 id="9-6-4-svm-with-multiple-classes">9.6.4 SVM with Multiple Classes</h3>
<p>The <a href="http://bit.ly/R_svm" target="_blank"><code>svm()</code></a> function can also be used to classify observations from multiple-classes.</p>
<pre><code class="lang-r">set.seed(<span class="hljs-number">1</span>)
x &lt;- rbind(x, matrix(rnorm(<span class="hljs-number">50</span> * <span class="hljs-number">2</span>), ncol = <span class="hljs-number">2</span>))
y &lt;- c(y, rep(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>))
x[y == <span class="hljs-number">0</span>, <span class="hljs-number">2</span>] &lt;- x[y == <span class="hljs-number">0</span>, <span class="hljs-number">2</span>] + <span class="hljs-number">2</span>
dat &lt;- data.frame(x = x, y = as.factor(y))
par(mfrow = c(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))
plot(x, col = (y + <span class="hljs-number">1</span>))
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-28-1.png" alt=""></p>
<p>The <a href="http://bit.ly/R_svm" target="_blank"><code>svm()</code></a> function now will perform multi-class classification since the dataset we generated now has three class labels.</p>
<pre><code class="lang-r">svmfit &lt;- svm(y ~ ., data = dat, kernel = <span class="hljs-string">&quot;radial&quot;</span>, cost = <span class="hljs-number">10</span>, gamma = <span class="hljs-number">1</span>)
plot(svmfit, dat)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-29-1.png" alt=""></p>
<h3 id="9-6-5-application-to-gene-expression-data">9.6.5 Application to Gene Expression Data</h3>
<p>In this final exercise we run SVM classifier on gene expression data. We load the <code>ISLR</code> package and examine the <code>Khan</code> dataset.</p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(ISLR)
names(Khan)
</code></pre>
<pre><code>## [1] &quot;xtrain&quot; &quot;xtest&quot;  &quot;ytrain&quot; &quot;ytest&quot;
</code></pre><pre><code class="lang-r">dim(Khan$xtrain)
</code></pre>
<pre><code>## [1]   63 2308
</code></pre><pre><code class="lang-r">dim(Khan$xtest)
</code></pre>
<pre><code>## [1]   20 2308
</code></pre><pre><code class="lang-r">length(Khan$ytrain)
</code></pre>
<pre><code>## [1] 63
</code></pre><pre><code class="lang-r">length(Khan$ytest)
</code></pre>
<pre><code>## [1] 20
</code></pre><p>We can examine the class labels associated with the training and test subsets.</p>
<pre><code class="lang-r">table(Khan$ytrain)
</code></pre>
<pre><code>## 
##  1  2  3  4 
##  8 23 12 20
</code></pre><pre><code class="lang-r">table(Khan$ytest)
</code></pre>
<pre><code>## 
## 1 2 3 4 
## 3 6 6 5
</code></pre><p>We use a linear kernel and run SVM classifier on the training subset.</p>
<pre><code class="lang-r">dat &lt;- data.frame(x = Khan$xtrain, y = as.factor(Khan$ytrain))
out &lt;- svm(y ~ ., data = dat, kernel = <span class="hljs-string">&quot;linear&quot;</span>, cost = <span class="hljs-number">10</span>)
summary(out)
</code></pre>
<pre><code>## 
## Call:
## svm(formula = y ~ ., data = dat, kernel = &quot;linear&quot;, cost = 10)
## 
## 
## Parameters:
##    SVM-Type:  C-classification 
##  SVM-Kernel:  linear 
##        cost:  10 
##       gamma:  0.0004332756 
## 
## Number of Support Vectors:  58
## 
##  ( 20 20 11 7 )
## 
## 
## Number of Classes:  4 
## 
## Levels: 
##  1 2 3 4
</code></pre><pre><code class="lang-r">table(out$fitted, dat$y)
</code></pre>
<pre><code>##    
##      1  2  3  4
##   1  8  0  0  0
##   2  0 23  0  0
##   3  0  0 12  0
##   4  0  0  0 20
</code></pre><p>We can then predict the classes on the test subset using the trained classifier.</p>
<pre><code class="lang-r">dat.te &lt;- data.frame(x = Khan$xtest, y = as.factor(Khan$ytest))
pred.te &lt;- predict(out, newdata = dat.te)
table(pred.te, dat.te$y)
</code></pre>
<pre><code>##        
## pred.te 1 2 3 4
##       1 3 0 0 0
##       2 0 6 2 0
##       3 0 0 4 0
##       4 0 0 0 5
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../chapter9/index.html" class="navigation navigation-prev " aria-label="Previous page: Chapter 9. Support Vector Machines"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../chapter9/solutions.html" class="navigation navigation-next " aria-label="Next page: Solutions"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
