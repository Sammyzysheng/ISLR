<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Lab | An Introduction to Statistical Learning:</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.2.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../chapter4/solutions.html" />
    
    
    <link rel="prev" href="../chapter4/index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="3.1" data-basepath=".." data-revision="Wed Aug 19 2015 19:44:06 GMT+0100 (BST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="chapter2/index.html">
            
                
                    <a href="../chapter2/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Chapter 2. Statistical Learning
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="chapter2/lab.html">
            
                
                    <a href="../chapter2/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="chapter2/solutions.html">
            
                
                    <a href="../chapter2/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="chapter3/index.html">
            
                
                    <a href="../chapter3/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Chapter 3. Linear Regression
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="chapter3/lab.html">
            
                
                    <a href="../chapter3/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="chapter3/solutions.html">
            
                
                    <a href="../chapter3/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="chapter4/index.html">
            
                
                    <a href="../chapter4/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Chapter 4. Classification
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="3.1" data-path="chapter4/lab.html">
            
                
                    <a href="../chapter4/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="chapter4/solutions.html">
            
                
                    <a href="../chapter4/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="chapter5/index.html">
            
                
                    <a href="../chapter5/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Chapter 5. Resampling Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="chapter5/lab.html">
            
                
                    <a href="../chapter5/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="chapter5/solutions.html">
            
                
                    <a href="../chapter5/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="chapter6/index.html">
            
                
                    <a href="../chapter6/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Chapter 6. Linear Model Selection and Regularization
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="chapter6/lab.html">
            
                
                    <a href="../chapter6/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="chapter6/solutions.html">
            
                
                    <a href="../chapter6/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="chapter7/index.html">
            
                
                    <a href="../chapter7/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Chapter 7. Moving Beyond Linearity
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="chapter7/lab.html">
            
                
                    <a href="../chapter7/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="chapter7/solutions.html">
            
                
                    <a href="../chapter7/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="chapter8/index.html">
            
                
                    <a href="../chapter8/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Chapter 8. Tree-Based Methods
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="chapter8/lab.html">
            
                
                    <a href="../chapter8/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="chapter8/solutions.html">
            
                
                    <a href="../chapter8/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="chapter9/index.html">
            
                
                    <a href="../chapter9/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Chapter 9. Support Vector Machines
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="chapter9/lab.html">
            
                
                    <a href="../chapter9/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="chapter9/solutions.html">
            
                
                    <a href="../chapter9/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="chapter10/index.html">
            
                
                    <a href="../chapter10/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Chapter 10. Unsupervised Learning
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="chapter10/lab.html">
            
                
                    <a href="../chapter10/lab.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Lab
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="chapter10/solutions.html">
            
                
                    <a href="../chapter10/solutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Solutions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="references.html">
            
                
                    <a href="../references.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        References
                    </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >An Introduction to Statistical Learning:</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="4-6-lab-logistic-regression-lda-qda-and-knn">4.6 Lab: Logistic Regression, LDA, QDA, and KNN</h2>
<h3 id="4-6-1-the-stock-market-data">4.6.1 The Stock Market Data</h3>
<p>Start by loading that <code>ISLR</code> package and attach to the <code>Smarket</code> dataset that we will be using throughtout this exercise.</p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(ISLR)
</code></pre>
<pre><code class="lang-r"><span class="hljs-keyword">attach</span>(Smarket)
</code></pre>
<pre><code class="lang-r">names(Smarket)
</code></pre>
<pre><code>## [1] &quot;Year&quot;      &quot;Lag1&quot;      &quot;Lag2&quot;      &quot;Lag3&quot;      &quot;Lag4&quot;      &quot;Lag5&quot;     
## [7] &quot;Volume&quot;    &quot;Today&quot;     &quot;Direction&quot;
</code></pre><pre><code class="lang-r">pairs(Smarket)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-3-1.png" alt=""></p>
<p>The <a href="http://bit.ly/R_cor" target="_blank"><code>cor()</code></a> function is used to show a matrix of all pairwise correlations among the predictors in the <code>Smarket</code> dataset.</p>
<pre><code class="lang-r">cor(Smarket[, -<span class="hljs-number">9</span>])
</code></pre>
<pre><code>##              Year         Lag1         Lag2         Lag3         Lag4
## Year   1.00000000  0.029699649  0.030596422  0.033194581  0.035688718
## Lag1   0.02969965  1.000000000 -0.026294328 -0.010803402 -0.002985911
## Lag2   0.03059642 -0.026294328  1.000000000 -0.025896670 -0.010853533
## Lag3   0.03319458 -0.010803402 -0.025896670  1.000000000 -0.024051036
## Lag4   0.03568872 -0.002985911 -0.010853533 -0.024051036  1.000000000
## Lag5   0.02978799 -0.005674606 -0.003557949 -0.018808338 -0.027083641
## Volume 0.53900647  0.040909908 -0.043383215 -0.041823686 -0.048414246
## Today  0.03009523 -0.026155045 -0.010250033 -0.002447647 -0.006899527
##                Lag5      Volume        Today
## Year    0.029787995  0.53900647  0.030095229
## Lag1   -0.005674606  0.04090991 -0.026155045
## Lag2   -0.003557949 -0.04338321 -0.010250033
## Lag3   -0.018808338 -0.04182369 -0.002447647
## Lag4   -0.027083641 -0.04841425 -0.006899527
## Lag5    1.000000000 -0.02200231 -0.034860083
## Volume -0.022002315  1.00000000  0.014591823
## Today  -0.034860083  0.01459182  1.000000000
</code></pre><p>Use the <a href="http://bit.ly/R_plot" target="_blank"><code>plot()</code></a> function to produce a scatter plot or the variable <code>Volume</code>.</p>
<pre><code class="lang-r">plot(Volume)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-5-1.png" alt=""></p>
<h3 id="4-6-2-logistic-regression">4.6.2 Logistic Regression</h3>
<p>The <a href="http://bit.ly/R_glm" target="_blank"><code>glm()</code></a> function can be used to fit a logistic regression model by specifying <code>family=binomial</code>.</p>
<pre><code class="lang-r">glm.fit &lt;- glm(Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + Volume, data = Smarket, family = binomial)
summary(glm.fit)
</code></pre>
<pre><code>## 
## Call:
## glm(formula = Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + 
##     Volume, family = binomial, data = Smarket)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.446  -1.203   1.065   1.145   1.326  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept) -0.126000   0.240736  -0.523    0.601
## Lag1        -0.073074   0.050167  -1.457    0.145
## Lag2        -0.042301   0.050086  -0.845    0.398
## Lag3         0.011085   0.049939   0.222    0.824
## Lag4         0.009359   0.049974   0.187    0.851
## Lag5         0.010313   0.049511   0.208    0.835
## Volume       0.135441   0.158360   0.855    0.392
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1731.2  on 1249  degrees of freedom
## Residual deviance: 1727.6  on 1243  degrees of freedom
## AIC: 1741.6
## 
## Number of Fisher Scoring iterations: 3
</code></pre><p>Similar to linear models estimated with the <a href="http://bit.ly/R_lm" target="_blank"><code>lm()</code></a>, the logistic regression model fitted with <a href="http://bit.ly/R_glm" target="_blank"><code>glm()</code></a> can be examined with the <a href="http://bit.ly/R_summary" target="_blank"><code>summary()</code></a> and <a href="http://bit.ly/R_coef" target="_blank"><code>coef()</code></a></p>
<pre><code class="lang-r">coef(glm.fit)
</code></pre>
<pre><code>##  (Intercept)         Lag1         Lag2         Lag3         Lag4 
## -0.126000257 -0.073073746 -0.042301344  0.011085108  0.009358938 
##         Lag5       Volume 
##  0.010313068  0.135440659
</code></pre><pre><code class="lang-r">summary(glm.fit)$coef
</code></pre>
<pre><code>##                 Estimate Std. Error    z value  Pr(&gt;|z|)
## (Intercept) -0.126000257 0.24073574 -0.5233966 0.6006983
## Lag1        -0.073073746 0.05016739 -1.4565986 0.1452272
## Lag2        -0.042301344 0.05008605 -0.8445733 0.3983491
## Lag3         0.011085108 0.04993854  0.2219750 0.8243333
## Lag4         0.009358938 0.04997413  0.1872757 0.8514445
## Lag5         0.010313068 0.04951146  0.2082966 0.8349974
## Volume       0.135440659 0.15835970  0.8552723 0.3924004
</code></pre><pre><code class="lang-r">summary(glm.fit)$coef[, <span class="hljs-number">4</span>]
</code></pre>
<pre><code>## (Intercept)        Lag1        Lag2        Lag3        Lag4        Lag5 
##   0.6006983   0.1452272   0.3983491   0.8243333   0.8514445   0.8349974 
##      Volume 
##   0.3924004
</code></pre><p>The <a href="http://bit.ly/R_predict" target="_blank"><code>predict()</code></a> function is used similary to generate predictions for the response variable.</p>
<pre><code class="lang-r">glm.probs &lt;- predict(glm.fit, type = <span class="hljs-string">&quot;response&quot;</span>)
glm.probs[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>]
</code></pre>
<pre><code>##         1         2         3         4         5         6         7 
## 0.5070841 0.4814679 0.4811388 0.5152224 0.5107812 0.5069565 0.4926509 
##         8         9        10 
## 0.5092292 0.5176135 0.4888378
</code></pre><p>Use the <a href="http://bit.ly/R_contrasts" target="_blank"><code>contrasts()</code></a> function to see the dummy variables generated for values in the categorical variable <code>Direction</code>.</p>
<pre><code class="lang-r">contrasts(Direction)
</code></pre>
<pre><code>##      Up
## Down  0
## Up    1
</code></pre><p>Next we convert the predicted probabilities to either &quot;Up&quot; or &quot;Down&quot; based on whether the probability is less than or greater than 0.5.</p>
<pre><code class="lang-r">glm.pred &lt;- rep(<span class="hljs-string">&quot;Down&quot;</span>, <span class="hljs-number">1250</span>)
glm.pred[glm.probs &gt; <span class="hljs-number">0.5</span>] &lt;- <span class="hljs-string">&quot;Up&quot;</span>
</code></pre>
<p>We can generate a confusion matrix between the predicted direction and the actual direction from the variable <code>Direction</code> using the <a href="http://bit.ly/R_table" target="_blank"><code>table()</code></a> function.</p>
<pre><code class="lang-r">table(glm.pred, Direction)
</code></pre>
<pre><code>##         Direction
## glm.pred Down  Up
##     Down  145 141
##     Up    457 507
</code></pre><pre><code class="lang-r">mean(glm.pred == Direction)
</code></pre>
<pre><code>## [1] 0.5216
</code></pre><p>We then divide our dataset into training set and validation set. The training set will include observations from 2001-2004 and the validation set from the year 2005.</p>
<pre><code class="lang-r">train &lt;- (Year &lt; <span class="hljs-number">2005</span>)
Smarket.2005= Smarket [! train ,]
dim(Smarket.2005)
</code></pre>
<pre><code>## [1] 252   9
</code></pre><pre><code class="lang-r">Direction.2005=Direction[!train]
</code></pre>
<p>We can run the loggistic regression again using <a href="http://bit.ly/R_glm" target="_blank"><code>glm()</code></a> but this time restricting our training set to obervations in the subset <code>train</code>.</p>
<pre><code class="lang-r">glm.fit &lt;- glm(Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + Volume, data = Smarket, family = binomial, subset = train)
glm.probs &lt;- predict(glm.fit, Smarket.2005, type = <span class="hljs-string">&quot;response&quot;</span>)
</code></pre>
<p>Next we compare the predictions for 2005 based on the model generated from our <code>train</code> subset.</p>
<pre><code class="lang-r">glm.pred &lt;- rep(<span class="hljs-string">&quot;Down&quot;</span>, <span class="hljs-number">252</span>)
glm.pred[glm.probs &gt; <span class="hljs-number">0.5</span>] &lt;- <span class="hljs-string">&quot;Up&quot;</span>
table(glm.pred, Direction.2005)
</code></pre>
<pre><code>##         Direction.2005
## glm.pred Down Up
##     Down   77 97
##     Up     34 44
</code></pre><pre><code class="lang-r">mean(glm.pred == Direction.2005)
</code></pre>
<pre><code>## [1] 0.4801587
</code></pre><pre><code class="lang-r">mean(glm.pred != Direction.2005)
</code></pre>
<pre><code>## [1] 0.5198413
</code></pre><p>To improve the preditive performance, we can restrict the predictor variables to only those with the strongest relationship to the response variable. In this case, we limit the variables to <code>Lag1</code> and <code>Lag2</code>.</p>
<pre><code class="lang-r">glm.fit &lt;- glm(Direction ~ Lag1 + Lag2, data = Smarket, family = binomial, subset = train)
glm.probs &lt;- predict(glm.fit, Smarket.2005, type = <span class="hljs-string">&quot;response&quot;</span>)
glm.pred &lt;- rep(<span class="hljs-string">&quot;Down&quot;</span>, <span class="hljs-number">252</span>)
glm.pred[glm.probs &gt; <span class="hljs-number">0.5</span>] &lt;- <span class="hljs-string">&quot;Up&quot;</span>
table(glm.pred, Direction.2005)
</code></pre>
<pre><code>##         Direction.2005
## glm.pred Down  Up
##     Down   35  35
##     Up     76 106
</code></pre><pre><code class="lang-r">mean(glm.pred == Direction.2005)
</code></pre>
<pre><code>## [1] 0.5595238
</code></pre><pre><code class="lang-r">predict(glm.fit,newdata=data.frame(Lag1=c(<span class="hljs-number">1.2</span>,<span class="hljs-number">1.5</span>), Lag2=c(<span class="hljs-number">1.1</span>,-<span class="hljs-number">0.8</span>)),type=<span class="hljs-string">&quot;response&quot;</span>)
</code></pre>
<pre><code>##         1         2 
## 0.4791462 0.4960939
</code></pre><h3 id="4-6-3-linear-discriminant-analysis">4.6.3 Linear Discriminant Analysis</h3>
<p>Let&apos;s first load the <code>MASS</code> package so we can train an LDA model with the <a href="http://bit.ly/R_lda" target="_blank"><code>lda()</code></a> function.</p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(MASS)
lda.fit &lt;- lda(Direction ~ Lag1 + Lag2, data = Smarket, subset = train)
plot(lda.fit)
</code></pre>
<p><img src="lab_files/figure-markdown_github+backtick_code_blocks+autolink_bare_uris/unnamed-chunk-17-1.png" alt=""></p>
<p>The <a href="http://bit.ly/R_predict" target="_blank"><code>preditc()</code></a> function for an LDA model returns a list of three elements representing the predicted class, the posterior probabilities and the linear discriminants as shown below.</p>
<pre><code class="lang-r">lda.pred &lt;- predict(lda.fit, Smarket.2005)
names(lda.pred)
</code></pre>
<pre><code>## [1] &quot;class&quot;     &quot;posterior&quot; &quot;x&quot;
</code></pre><p>We can compare the predicted class with the predicted directed obtained from logistic regression in the previous section and stored in the vector <code>Direction.2005</code>.</p>
<pre><code class="lang-r">lda.class &lt;- lda.pred$class
table(lda.class, Direction.2005)
</code></pre>
<pre><code>##          Direction.2005
## lda.class Down  Up
##      Down   35  35
##      Up     76 106
</code></pre><pre><code class="lang-r">mean(lda.class == Direction.2005)
</code></pre>
<pre><code>## [1] 0.5595238
</code></pre><pre><code class="lang-r">sum(lda.pred$posterior[, <span class="hljs-number">1</span>] &gt;= <span class="hljs-number">0.5</span>)
</code></pre>
<pre><code>## [1] 70
</code></pre><pre><code class="lang-r">sum(lda.pred$posterior[, <span class="hljs-number">1</span>] &lt; <span class="hljs-number">0.5</span>)
</code></pre>
<pre><code>## [1] 182
</code></pre><p>We can inspect the posterior probabilities of the LDA model from the <code>posterior</code> vector of the fitted model.</p>
<pre><code class="lang-r">lda.pred$posterior[<span class="hljs-number">1</span>:<span class="hljs-number">20</span>, <span class="hljs-number">1</span>]
</code></pre>
<pre><code>##       999      1000      1001      1002      1003      1004      1005 
## 0.4901792 0.4792185 0.4668185 0.4740011 0.4927877 0.4938562 0.4951016 
##      1006      1007      1008      1009      1010      1011      1012 
## 0.4872861 0.4907013 0.4844026 0.4906963 0.5119988 0.4895152 0.4706761 
##      1013      1014      1015      1016      1017      1018 
## 0.4744593 0.4799583 0.4935775 0.5030894 0.4978806 0.4886331
</code></pre><pre><code class="lang-r">lda.class[<span class="hljs-number">1</span>:<span class="hljs-number">20</span>]
</code></pre>
<pre><code>##  [1] Up   Up   Up   Up   Up   Up   Up   Up   Up   Up   Up   Down Up   Up  
## [15] Up   Up   Up   Down Up   Up  
## Levels: Down Up
</code></pre><p>We can also set the posterior probabilities to different thresholds for making predictions.</p>
<pre><code class="lang-r">sum(lda.pred$posterior[, <span class="hljs-number">1</span>] &gt; <span class="hljs-number">0.9</span>)
</code></pre>
<pre><code>## [1] 0
</code></pre><h3 id="4-6-4-quadratic-discriminant-analysis">4.6.4 Quadratic Discriminant Analysis</h3>
<p>In addition to Linear Discriminant Analysis (LDA), the MASS package also offers a Quadratic Discriminant Analysis (LDA) model that we can fit with the <a href="http://bit.ly/R_qda" target="_blank"><code>qda()</code></a> function.</p>
<pre><code class="lang-r">qda.fit &lt;- qda(Direction ~ Lag1 + Lag2, data = Smarket, subset = train)
qda.fit
</code></pre>
<pre><code>## Call:
## qda(Direction ~ Lag1 + Lag2, data = Smarket, subset = train)
## 
## Prior probabilities of groups:
##     Down       Up 
## 0.491984 0.508016 
## 
## Group means:
##             Lag1        Lag2
## Down  0.04279022  0.03389409
## Up   -0.03954635 -0.03132544
</code></pre><p>We can make predictions using <a href="http://bit.ly/R_predict" target="_blank"><code>predict()</code></a> just as we did for an LDA model and compare them to the results from the logistic regression.</p>
<pre><code class="lang-r">qda.class &lt;- predict(qda.fit, Smarket.2005)$class
table(qda.class, Direction.2005)
</code></pre>
<pre><code>##          Direction.2005
## qda.class Down  Up
##      Down   30  20
##      Up     81 121
</code></pre><pre><code class="lang-r">mean(qda.class == Direction.2005)
</code></pre>
<pre><code>## [1] 0.5992063
</code></pre><h3 id="4-6-5-k-nearest-neighbors">4.6.5 K-Nearest Neighbors</h3>
<p>The <code>class</code> package offers a number of classification algorithms including K-Nearest Neighbors. Before we can run the KNN algorithm, we need to split our dataset into training and test subsets. After splitting the dataset, the <a href="http://bit.ly/R_cbind" target="_blank"><code>cbind()</code></a> is used to bind the <code>Lag1</code> and <code>Lag2</code> variables into a matrix for each subset.</p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(class)
train.X &lt;- cbind(Lag1, Lag2)[train, ]
test.X &lt;- cbind(Lag1, Lag2)[!train, ]
train.Direction &lt;- Direction[train]
</code></pre>
<p>We initialize the random number generator with <a href="http://bit.ly/R_set_seed" target="_blank">set.seed()</a> to ensure that repeated runs produce consistent results and then use <a href="http://bit.ly/R_knn" target="_blank"><code>knn()</code></a> to make predictions about the market direction in 2005.</p>
<pre><code class="lang-r">set.seed(<span class="hljs-number">1</span>)
knn.pred &lt;- knn(train.X, test.X, train.Direction, k = <span class="hljs-number">1</span>)
table(knn.pred, Direction.2005)
</code></pre>
<pre><code>##         Direction.2005
## knn.pred Down Up
##     Down   43 58
##     Up     68 83
</code></pre><pre><code class="lang-r">(<span class="hljs-number">83</span> + <span class="hljs-number">43</span>)/<span class="hljs-number">252</span>
</code></pre>
<pre><code>## [1] 0.5
</code></pre><p>We can repeat the fit with K = 3.</p>
<pre><code class="lang-r">knn.pred &lt;- knn(train.X, test.X, train.Direction, k = <span class="hljs-number">3</span>)
table(knn.pred, Direction.2005)
</code></pre>
<pre><code>##         Direction.2005
## knn.pred Down Up
##     Down   48 54
##     Up     63 87
</code></pre><pre><code class="lang-r">mean(knn.pred == Direction.2005)
</code></pre>
<pre><code>## [1] 0.5357143
</code></pre><h3 id="4-6-6-an-application-to-caravan-insurance-data">4.6.6 An Application to Caravan Insurance Data</h3>
<p>We first use the <a href="http://bit.ly/R_attach" target="_blank"><code>attach()</code></a> function to make the <code>Caravan</code> dataset available to us.</p>
<pre><code class="lang-r"><span class="hljs-keyword">attach</span>(Caravan)
</code></pre>
<p>Lets explore the dataset with the <a href="http://bit.ly/R_dim" target="_blank"><code>dim()</code></a> and <a href="http://bit.ly/R_summary" target="_blank"><code>summary()</code></a> functions.</p>
<pre><code class="lang-r">dim(Caravan)
</code></pre>
<pre><code>## [1] 5822   86
</code></pre><pre><code class="lang-r">summary(Purchase)
</code></pre>
<pre><code>##   No  Yes 
## 5474  348
</code></pre><pre><code class="lang-r"><span class="hljs-number">348</span>/<span class="hljs-number">5822</span>
</code></pre>
<pre><code>## [1] 0.05977327
</code></pre><p>We use the <a href="http://bit.ly/R_scale" target="_blank"><code>scale()</code></a> function to scale the dataset with a mean of zero and standard deviation of one.</p>
<pre><code class="lang-r">standardized.X &lt;- scale(Caravan[, -<span class="hljs-number">86</span>])
var(Caravan[, <span class="hljs-number">1</span>])
</code></pre>
<pre><code>## [1] 165.0378
</code></pre><pre><code class="lang-r">var(Caravan[, <span class="hljs-number">2</span>])
</code></pre>
<pre><code>## [1] 0.1647078
</code></pre><pre><code class="lang-r">var(standardized.X[, <span class="hljs-number">1</span>])
</code></pre>
<pre><code>## [1] 1
</code></pre><pre><code class="lang-r">var(standardized.X[, <span class="hljs-number">2</span>])
</code></pre>
<pre><code>## [1] 1
</code></pre><p>We use the producedure described in the previous section of splitting the dataset into training and test sets and making prediction about the response variable <code>Purchase</code> using a KNN model.</p>
<pre><code class="lang-r">test &lt;- <span class="hljs-number">1</span>:<span class="hljs-number">1000</span>
train.X &lt;- standardized.X[-test, ]
test.X &lt;- standardized.X[test, ]
train.Y &lt;- Purchase[-test]
test.Y &lt;- Purchase[test]
set.seed(<span class="hljs-number">1</span>)
knn.pred &lt;- knn(train.X, test.X, train.Y, k = <span class="hljs-number">1</span>)
mean(test.Y != knn.pred)
</code></pre>
<pre><code>## [1] 0.118
</code></pre><pre><code class="lang-r">mean(test.Y != <span class="hljs-string">&quot;No&quot;</span>)
</code></pre>
<pre><code>## [1] 0.059
</code></pre><pre><code class="lang-r">table(knn.pred, test.Y)
</code></pre>
<pre><code>##         test.Y
## knn.pred  No Yes
##      No  873  50
##      Yes  68   9
</code></pre><pre><code class="lang-r"><span class="hljs-number">9</span>/(<span class="hljs-number">68</span> + <span class="hljs-number">9</span>)
</code></pre>
<pre><code>## [1] 0.1168831
</code></pre><p>We can repeat this process with different values of K, for example, K = 3 and K = 5.</p>
<pre><code class="lang-r">knn.pred &lt;- knn(train.X, test.X, train.Y, k = <span class="hljs-number">3</span>)
table(knn.pred, test.Y)
</code></pre>
<pre><code>##         test.Y
## knn.pred  No Yes
##      No  920  54
##      Yes  21   5
</code></pre><pre><code class="lang-r"><span class="hljs-number">5</span>/<span class="hljs-number">26</span>
</code></pre>
<pre><code>## [1] 0.1923077
</code></pre><pre><code class="lang-r">knn.pred &lt;- knn(train.X, test.X, train.Y, k = <span class="hljs-number">5</span>)
table(knn.pred, test.Y)
</code></pre>
<pre><code>##         test.Y
## knn.pred  No Yes
##      No  930  55
##      Yes  11   4
</code></pre><pre><code class="lang-r"><span class="hljs-number">4</span>/<span class="hljs-number">15</span>
</code></pre>
<pre><code>## [1] 0.2666667
</code></pre><p>Finally, we compare the KNN model with a logistic regression using <a href="http://bit.ly/R_glm" target="_blank"><code>glm()</code></a> and <code>family = binomial</code>.</p>
<pre><code class="lang-r">glm.fit &lt;- glm(Purchase ~ ., data = Caravan, family = binomial, subset = -test)
</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
</code></pre><pre><code class="lang-r">glm.probs &lt;- predict(glm.fit, Caravan[test, ], type = <span class="hljs-string">&quot;response&quot;</span>)
glm.pred &lt;- rep(<span class="hljs-string">&quot;No&quot;</span>, <span class="hljs-number">1000</span>)
glm.pred[glm.probs &gt; <span class="hljs-number">0.5</span>] &lt;- <span class="hljs-string">&quot;Yes&quot;</span>
table(glm.pred, test.Y)
</code></pre>
<pre><code>##         test.Y
## glm.pred  No Yes
##      No  934  59
##      Yes   7   0
</code></pre><pre><code class="lang-r">glm.pred &lt;- rep(<span class="hljs-string">&quot;No&quot;</span>, <span class="hljs-number">1000</span>)
glm.pred[glm.probs &gt; <span class="hljs-number">0.25</span>] &lt;- <span class="hljs-string">&quot; Yes&quot;</span>
table(glm.pred, test.Y)
</code></pre>
<pre><code>##         test.Y
## glm.pred  No Yes
##      Yes  22  11
##     No   919  48
</code></pre><pre><code class="lang-r"><span class="hljs-number">11</span>/(<span class="hljs-number">22</span> + <span class="hljs-number">11</span>)
</code></pre>
<pre><code>## [1] 0.3333333
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../chapter4/index.html" class="navigation navigation-prev " aria-label="Previous page: Chapter 4. Classification"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../chapter4/solutions.html" class="navigation navigation-next " aria-label="Next page: Solutions"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
